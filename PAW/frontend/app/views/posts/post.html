<div ng-controller="PostCtrl">
  <div class="content-no-sidebar-left">

    <!--Questions Section -->
    <div class="ml-4 mr-1 description-text"><h1><c:out value="${post.title}"/></h1></div>

    <div ng-if="${isAdmin || isOwner}">
      <div class="row d-flex my-1 justify-content-end">
        <div class="row d-flex">
          <div class="mb-4 mx-2">
            <a href="/posts/edit_post/${post.postId}" >
            <button class="btn btn-info btn-block text-nowrap" type="button">
              <i class="fa fa-edit fa-sm mr-1"></i>
              {{'BUTTON_EDIT_POST' | translate}}
            </button>
            </a>
          </div>
          <div class="mx-2">
            <button class="btn btn-danger btn-block text-nowrap" type="button" onclick="openDeletePostModal(${post.postId})" data-toggle="modal" data-target="#deletePostModal">
              <i class="fas fa-trash-alt fa-sm mr-1"></i>
              {{'BUTTON_DELETE_POST' | translate}}
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="post-cards">
      <div class="row post-data">
        <!-- Up Vote - Down Vote section -->
        <div class=" ml-4 col-1 net-votes">
          <c:choose>
            <c:when test="${user.name == 'anonymousUser'}">
              <button class="btn pt-0 pb-0"><i class="fa fa-2x fa-arrow-up" data-toggle="modal" data-target="#loginModal"></i></button>
              <div>
                <h4>${post.votesUp - post.votesDown}</h4>
              </div>
              <button class="btn pt-0 pb-0"><i class="fa fa-2x fa-arrow-down" data-toggle="modal" data-target="#loginModal"></i></button>
            </c:when>
            <c:otherwise>
              <c:choose>
                <c:when test="${!isEnable}">
                  <button class="btn pt-0 pb-0"><i class="fa fa-2x fa-arrow-up" data-toggle="modal" data-target="#confirmMailModal"></i></button>
                  <div>
                    <h4>${post.votesUp - post.votesDown}</h4>
                  </div>
                  <button class="btn pt-0 pb-0"><i class="fa fa-2x fa-arrow-down" data-toggle="modal" data-target="#confirmMailModal"></i></button>
                </c:when>
                <c:otherwise>

                  <form name="upVoteForm"  id="upVoteForm${post.postId}" action="/posts/${post.postId}/upVote/" method="post" class="mb-0 mt-0">
                    <label for="upVotePostId">
                      <input id="upVotePostId${post.postId}" class="input-wrap" id="upVotePostId" type="hidden" value="${post.postId}"/>
                    </label>
                    <div class="net-votes">
                      <button class="btn pt-0 pb-0" type="submit">
                        <c:choose>
                          <c:when test="${post.getUserAuthVote(user.name) > 0}">
                            <i class="fa fa-2x fa-arrow-up votedUp"></i>
                          </c:when>
                          <c:otherwise>
                            <i class="fa fa-2x fa-arrow-up"></i>
                          </c:otherwise>
                        </c:choose>
                      </button>
                      <div>
                        <h4>${post.votesUp - post.votesDown}</h4>
                      </div>
                    </div>
                  </form>

                  <form name="downVoteForm" id="downVoteForm${post.postId}" action="/posts/${post.postId}/downVote/" method="post" class="mt-0">
                    <label for="downVotePostId${post.postId}">
                      <input  id="downVotePostId${post.postId}" class="input-wrap" type="hidden" value="${post.postId}"/>
                    </label>
                    <div class="net-votes">
                      <button class="btn pt-0 pb-0" type="submit">
                        <c:choose>
                          <c:when test="${post.getUserAuthVote(user.name) < 0}">
                            <i class="fa fa-2x fa-arrow-down votedDown"></i>
                          </c:when>
                          <c:otherwise>
                            <i class="fa fa-2x fa-arrow-down"></i>
                          </c:otherwise>
                        </c:choose>
                      </button>
                    </div>
                  </form>

                </c:otherwise>
              </c:choose>
            </c:otherwise>
          </c:choose>
        </div>
        <div class="col-9">
          <div class="row post-description description-text">
            <c:out value="${post.description}" />
          </div>
          <div class="row extra-info">
            <!-- Tags section -->
            <div class="col-9 tags">
              <c:forEach items="${post.postTags}" var="tag">
                <button  class="badge badge-color ml-1" onclick="goToExplore('${tag.tagName}','${tag.type.name()}')">
                  <span>
                      <c:choose>
                          <c:when test="${tag.type.name() == 'tech_name'}">
                              <c:out value="${tag.tagName}"/>
                          </c:when>
                          <c:when test="${tag.type.name() == 'tech_type'}">
                              <spring:message code="type.${tag.tagName}"/>
                          </c:when>
                          <c:otherwise>
                              <spring:message code="category.${tag.tagName}"/>
                          </c:otherwise>
                      </c:choose>
                  </span>
                </button>
              </c:forEach>
            </div>
            <div class="col">
              <div class="row d-flex secondary-color text-right post-date">
                <c:out value="${post.timestamp.toLocaleString()}" />
              </div>
              <div class="row d-flex secondary-color text-right">
                <a href="/users/${post.user.username}">${post.user.username}</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- Answers Section -->
  <div class="answers">
    <div class="title"><h3>{{'POST_ANSWERS' | translate}}</h3></div>
    <c:choose>
      <c:when test="${not empty answers}">
        <c:forEach var="answer" items="${answers}">
          <div class="post-cards">
            <div class="card mb-3 post-card-answer">
              <div class="card-body">
                <!-- Delete comment -->
                <div ng-if="${isAdmin || isOwner || answer.user.username == user.name}">
                  <div class="row">
                      <span class="col d-flex justify-content-end align-items-end">
                          <button class="btn btn-link" onclick="openDeleteCommentModal(${answer.postCommentId})"  data-toggle="modal" data-target="#deleteCommentModal"><i class="fa fa-trash"></i></button>
                      </span>
                  </div>
                </div>
                <div class="row">
                  <!-- Up Vote - Down Vote section -->
                  <div class="col-1 net-votes">
                    <c:choose>
                      <c:when test="${user.name == 'anonymousUser'}">
                        <button class="btn pt-0 pb-0"><i class="fa fa-1x fa-arrow-up" data-toggle="modal" data-target="#loginModal"></i></button>
                        <div>
                          <h4>${answer.votesUp- answer.votesDown}</h4>
                        </div>
                        <button class="btn pt-0 pb-0"><i class="fa fa-1x fa-arrow-down" data-toggle="modal" data-target="#loginModal"></i></button>
                      </c:when>
                      <c:otherwise>
                        <c:choose>
                          <c:when test="${!isEnable}">
                            <button class="btn pt-0 pb-0"><i class="fa fa-1x fa-arrow-up" data-toggle="modal" data-target="#confirmMailModal"></i></button>
                            <div>
                              <h4>${answer.votesUp - answer.votesDown}</h4>
                            </div>
                            <button class="btn pt-0 pb-0"><i class="fa fa-1x fa-arrow-down" data-toggle="modal" data-target="#confirmMailModal"></i></button>
                          </c:when>
                          <c:otherwise>
                            <c:url value="/posts/${post.postId}/upVoteComment/" var="postPathUpVoteComment"/>
                            <form:form modelAttribute="upVoteCommentForm" id="upVoteCommentForm${post.postId}CommentId${answer.postCommentId}" action="${postPathUpVoteComment}" method="post" class="mb-0 mt-0 pt-0">
                              <form:label path="upVoteCommentPostId" class="hidden-no-space">
                                <form:input id="upVoteCommentPostId${post.postId}CommentId${answer.postCommentId}" class="hidden-no-space" path="upVoteCommentPostId" value="${post.postId}"/>
                              </form:label>
                              <form:label path="postCommentUpVoteId" class="hidden-no-space">
                                <form:input id="postCommentId${answer.postCommentId}UpVote" class="hidden-no-space" path="postCommentUpVoteId" value="${answer.postCommentId}"/>
                              </form:label>

                              <div class="net-votes pt-0 mt-0 mb-0 pb-0">
                                <button class="btn pt-0 pb-0" type="submit">
                                  <c:choose>
                                    <c:when test="${answer.getUserAuthVote(user.name) > 0}">
                                      <i class="fa fa-1x fa-arrow-up votedUp"></i>
                                    </c:when>
                                    <c:otherwise>
                                      <i class="fa fa-1x fa-arrow-up"></i>
                                    </c:otherwise>
                                  </c:choose>
                                </button>
                                <div>
                                  <div>${answer.votesUp - answer.votesDown}</div>
                                </div>
                              </div>
                            </form:form>

                            <c:url value="/posts/${post.postId}/downVoteComment/" var="postPathDownVoteComment"/>
                            <form:form modelAttribute="downVoteCommentForm" id="downVoteCommentForm${post.postId}/${answer.postCommentId}" action="${postPathDownVoteComment}" method="post" class="mb-0 mt-0">
                              <form:label path="downVoteCommentPostId">
                                <form:input id="downVoteCommentPostId${post.postId}CommentId${answer.postCommentId}" class="input-wrap hidden-no-space" path="downVoteCommentPostId" value="${post.postId}"/>
                              </form:label>

                              <div class="net-votes">
                                <button class="btn pt-0 pb-0" type="submit">
                                  <c:choose>
                                    <c:when test="${answer.getUserAuthVote(user.name) < 0}">
                                      <i class="fa fa-1x fa-arrow-down votedDown"></i>
                                    </c:when>
                                    <c:otherwise>
                                      <i class="fa fa-1x fa-arrow-down"></i>
                                    </c:otherwise>
                                  </c:choose>
                                </button>
                              </div>
                              <form:label path="postCommentDownVoteId">
                                <form:input id="postCommentId${answer.postCommentId}DownVote" class="input-wrap hidden-no-space" path="postCommentDownVoteId" value="${answer.postCommentId}"/>
                              </form:label>
                            </form:form>
                          </c:otherwise>
                        </c:choose>
                      </c:otherwise>
                    </c:choose>
                  </div>
                  <div class="col-10">
                    <div class="row post-description align-items-center description-text">
                      <c:out value="${answer.description}"/>
                    </div>
                    <div class="row extra-info">
                      <div class="col-9 tags"></div>
                      <div class="col">
                        <div class="row d-flex secondary-color text-right post-date">
                          <c:out value="${answer.timestamp.toLocaleString()}"/>
                        </div>
                        <div class="row d-flex secondary-color text-right">
                          <a ng-href="/users/${answer.user.username}">${answer.user.username}</a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </c:forEach>
      </c:when>
      <c:otherwise>
        <div class="row justify-content-center mt-2">
          <spring:message code="post.no_answers_yet"/>
        </div>
      </c:otherwise>
    </c:choose>
  </div>
  <!-- Answers pagination -->
  <jsp:include page="../components/pagination.jsp">
    <jsp:param name="total" value="${post.answersAmount}"/>
    <jsp:param name="page" value="${page}"/>
    <jsp:param name="page_size" value="${page_size}"/>
    <jsp:param name="origin" value='post_comment'/>
    <jsp:param name="post_id" value='${post.postId}'/>
    <jsp:param name="comments_page" value="${page}"/>
  </jsp:include>

  <div class="answers">
    <div class="title">
      <h4>{{'POST_ANSWER_YOURSELF' | translate}}</h4>
    </div>

    <!-- Leave a comment -->
    <div class="container margin-left">
      <div class="row comment-yourself">
        <div>
          <c:url value="/posts/comment" var="postPathComment"/>
          <form:form modelAttribute="postCommentForm" action="${postPathComment}" method="post">
            <form:errors path="comment" element="p" cssClass="formError"/>
            <form:label path="commentPostId"><form:input  class="input-wrap" path="commentPostId" type="hidden" value="${post.postId}"/></form:label>

            <form:label path="comment"/>
            <form:textarea path="comment" id="commentInput" class="form-control" aria-label="With textarea" rows="5" cols="100"/>

            <c:choose>
              <c:when test="${user.name != 'anonymousUser'}">
                <c:choose>
                  <c:when test="${!isEnable}">
                    <button type="button" id="commentButton" disabled class="btn btn-info margin-top d-flex justify-content-flex-end" data-toggle="modal" data-target="#confirmMailModal">{{'BUTTON_SUBMIT' | translate}}</button>
                  </c:when>
                  <c:otherwise>
                    <button type="submit" id="commentButton" disabled class="btn btn-info margin-top d-flex justify-content-flex-end">{{'BUTTON_SUBMIT' | translate}}</button>
                  </c:otherwise>
                </c:choose>
              </c:when>
              <c:otherwise>
                <button type="button" id="commentButton" disabled class="btn btn-info margin-top d-flex justify-content-flex-end" data-toggle="modal" data-target="#loginModal">{{'BUTTON_SUBMIT' | translate}}</button>
              </c:otherwise>
            </c:choose>
          </form:form>
        </div>
      </div>
    </div>
  </div>
</div>


</div>

