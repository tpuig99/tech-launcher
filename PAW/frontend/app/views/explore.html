<div ng-controller="ExploreCtrl">
  <div class="content-search">
    <div class="sidebar-search">
      <div class="d-flex justify-content-center">
        <button class="btn btn-width my-2 my-sm-0 primary-button" type="button" onclick="search()">{{'EXPLORE_FILTER' | translate}}</button>
      </div>

      <!-- Filter By Categories -->
      <div class="subtitle"><h4>{{'EXPLORE_CATEGORIES' | translate}}</h4></div>


        <div ng-repeat="category in categories" class="form-check">

          <div ng-if="$index <= 5 ">
            <input class="form-check-input" type="checkbox" value="" id="check{{category}}">
            <label class="form-check-label" for="check{{category}}">
              {{ "CATEGORY_" + category.category | uppercase | translate}}
            </label>
          </div>
        </div>

      <div>
        <button id="showMoreCategories" class="btn btn-link" onclick="showMore('Categories')">{{'EXPLORE_SHOW_MORE' | translate}}</button>
      </div>
      <div class="hide" id="hiddenCategories">
          <div ng-repeat="category in categories" class="form-check">
            <div ng-if="$index >= 6">
              <input class="form-check-input" type="checkbox" value="" >
              <label class="form-check-label" for="check{{category}}">
                {{category}}
              </label>
            </div>
          </div>
        <div>
          <button id="showLessCategories" class="btn btn-link" onclick="showLess('Categories')">{{'EXPLORE_SHOW_LESS' | translate}}</button>
        </div>
      </div>


      <!-- Filter By Types -->
      <div class="subtitle sidebar-title"><h4>{{'EXPLORE_TYPES' | translate}}</h4></div>

        <div ng-repeat="type in types" class="form-check">
          <div ng-if="$index <= 5">
            <input class="form-check-input" type="checkbox" value="">
            <label class="form-check-label" for="check{{type}}">
              {{type}}
            </label>
          </div>
        </div>

      <div>
        <button id="showMoreTypes" class="btn btn-link" onclick="showMore('Types')">{{'EXPLORE_SHOW_MORE' | translate}}</button>
      </div>
      <div class="hide" id="hiddenTypes">

          <div ng-repeat="type in types" class="form-check">
            <div ng-if="$index >= 6">
              <input class="form-check-input" type="checkbox" value="" id="check{{type}}">
              <label class="form-check-label" for="check{{type}}">
                {{type}}
              </label>
            </div>
          </div>

        <div>
          <button id="showLessTypes" class="btn btn-link" onclick="showLess('Types')">{{'EXPLORE_SHOW_LESS' | translate}}</button>
        </div>
      </div>


      <!--Filter By Comments Update Date-->

      <div class="subtitle sidebar-title"><h4>{{'EXPLORE_UPDATE_DATE' | translate}}</h4></div>

      <span>
        <select ng-model="lastUpdate" id="update-date-dropdown">
          <option value="0">{{'EXPLORE_ANY_DATE' | translate}}</option>
          <option value="1">{{'EXPLORE_LAST_DAYS' | translate}}</option>
          <option value="2">{{'EXPLORE_LAST_WEEK' | translate}}</option>
          <option value="3">{{'EXPLORE_LAST_MONTH' | translate}}</option>
          <option value="4">{{'EXPLORE_LAST_MONTHS' | translate}}</option>
          <option value="5" selected>{{'EXPLORE_LAST_YEAR' | translate}}</option>
        </select>
      </span>

      <!--Filter By Comments Date-->

      <div class="subtitle sidebar-title"><h4>{{'EXPLORE_COMMENT_DATE' | translate}}</h4></div>

      <span>
        <select ng-model="lastComment" id="comments-date-dropdown">
          <option value="0">{{'EXPLORE_ANY_DATE' | translate}}</option>
          <option value="1">{{'EXPLORE_LAST_DAYS' | translate}}</option>
          <option value="2">{{'EXPLORE_LAST_WEEK' | translate}}</option>
          <option value="3">{{'EXPLORE_LAST_MONTH' | translate}}</option>
          <option value="4">{{'EXPLORE_LAST_MONTHS' | translate}}</option>
          <option value="5">{{'EXPLORE_LAST_YEAR' | translate}}</option>
        </select>
      </span>


      <!--Filter By Comments Amount-->

      <div class="subtitle sidebar-title"><h4>{{'EXPLORE_COMMENTS' | translate}}</h4></div>

      <span>
        <select ng-model="commentAmount" id="comments-dropdown">
          <option value="0">{{'EXPLORE_COMMENTS_ALL' | translate}}</option>
          <option value="1">{{'EXPLORE_COMMENTS_FROM' | translate : '{amount:1}' }}</option>
          <option value="5">{{'EXPLORE_COMMENTS_FROM' | translate : '{amount:5}' }}</option>
          <option value="10">{{'EXPLORE_COMMENTS_FROM' | translate : '{amount:10}' }}</option>
          <option value="20">{{'EXPLORE_COMMENTS_FROM' | translate : '{amount:20}' }}</option>
          <option value="50">{{'EXPLORE_COMMENTS_FROM' | translate : '{amount:50}' }}</option>
        </select>
      </span>


      <!--Filter By Rating-->
      <div id="techRating">
        <div class="subtitle sidebar-title"><h4>{{'EXPLORE_RATING' | translate}}</h4></div>

        <span>{{'EXPLORE_FROM' | translate}}</span>
        <span>
          <select ng-model="starsLeft" id="stars-dropdown-1">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </span>
        <span>{{'EXPLORE_TO_5_STARS' | translate}}</span>
        <span>
          <select ng-model="starsRight" id="stars-dropdown-2">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </span>
      </div>

    </div>


    <!-- Search Bar -->
    <div class="search-bar sidebar-title">
      <form class="form-inline my-2 my-lg-0" id="search">
        <input ng-model="toSearch" id="searchInput" class="form-control mr-sm-2" type="text" value="{{techNameQuery}}" placeholder="{{'SEARCH_TITLE' | translate}}" aria-label="Search" size="80">
        <button class="btn my-2 my-sm-0 primary-button" type="button" ng-click="search()">{{'SEARCH_TITLE' | translate}}</button>
      </form>
      <div class="form-check" id="searchByNameCheckbox">
        <input ng-model="nameFlag.selected" class="form-check-input" type="checkbox" value="" id="searchOnlyByName">
        <label class="form-check-label" for="searchOnlyByName">
          {{'EXPLORE_SEARCH_ONLY_BY_NAME' | translate}}
        </label>
      </div>

      <!-- Sort -->
      <div class="d-flex flex-row justify-content-end">
        <div class="mx-2">
          <label class="subtitle" for="sortSelect">{{'EXPLORE_SORT_BY' | translate}}</label>
          <select class="form-control" id="sortSelect" oninput="sort()">
            <option value="0">{{'EXPLORE_SORT_BY_NONE' | translate}}</option>
            <option value="1">{{'EXPLORE_SORT_BY_RATING' | translate}}</option>
            <option value="2">{{'EXPLORE_SORT_BY_COMMENTS_AMOUNT' | translate}}</option>
            <option value="3">{{'EXPLORE_SORT_BY_TECH_UPDATED' | translate}}</option>
            <option value="4">{{'EXPLORE_SORT_BY_RECENTLY_COMMENTED' | translate}}</option>
          </select>
        </div>
        <div class="mx-2">
          <label class="subtitle" for="orderSelect">{{'EXPLORE_ORDER_BY' | translate}}</label>
          <select class="form-control" id="orderSelect" oninput="sort()">
            <option value="1">{{'EXPLORE_ORDER_BY_DESCENDANT' | translate}}</option>
            <option value="-1">{{'EXPLORE_ORDER_BY_ASCENDANT' | translate}}</option>
          </select>
        </div>
      </div>
    </div>


    <!--Search Results For / Explore -->
    <div class="page-description"></div>
    <div class="page-title">

      <div ng-switch="empty techNameQuery and empty starsQuery1 and empty starsQuery2 and empty categoriesQuery and empty typesQuery and empty orderValue and empty commentAmount and empty dateUpdate and empty dateComment and empty sortValue">
        <div ng-switch-when="true">
          <h2>{{'EXPLORE_TITLE' | translate}}</h2>
        </div>
        <div ng-switch-when="false">
          <h2>{{'EXPLORE_SEARCH_RESULTS' | translate}} (<span id="resultsNumber"></span>)</h2>
        </div>
      </div>
    </div>

    <!--Search Results Badges -->
    <div class="row">
      <div class="col-8">
        <div class="margin-top">

          <span id="name" class="badge badge-pill secondary-badge">{{toSearch}}</span>

          <span ng-if="!categoriesQuery.isEmpty()">
              <span ng-repeat="categoryQuery in categoriesQuery" id="name{{categoryQuery}}" class="badge badge-pill secondary-badge">{{category}}</span>
          </span>

          <span ng-if="!typesQuery.isEmpty()">
              <span ng-repeat="typeQuery in typesQuery" id="name{{typeQuery}}" class="badge badge-pill secondary-badge">{{type}}</span>
          </span>

          <span ng-if="!starsQuery1.isEmpty()" id="stars" class="badge badge-pill secondary-badge">{{'EXPLORE_STARS_QUERY' | translate : '{left: starsQuery1, right:starsQuery2}' }}</span>

          <span ng-if="!commentAmount.isEmpty() && commentAmount!=0" id="commentsAmount" class="badge badge-pill secondary-badge">{{'EXPLORE_COMMENTS_QUERY' | translate : '{amount: commentAmount}' }}</span>

          <span ng-if="!dateUpdate.isEmpty() && dateUpdate!=0" id="dateUpdate" class="badge badge-pill secondary-badge">{{'EXPLORE_UPDATE_DATE_QUERY' | translate : '{amount: dateUpdateTranslation}' }}</span>

          <span ng-if="!dateComment.isEmpty() && dateComment!=0" id="dateComment" class="badge badge-pill secondary-badge">{{'EXPLORE_COMMENTS_DATE_QUERY' | translate : '{amount: dateCommentTranslation}' }}</span>

        </div>
      </div>
    </div>

    <div class="page-description"></div>

    <!-- TABS -->

    <ul class="nav nav-tabs" id="searchTabs">
      <li class="nav-item">
        <a  class="nav-link" href="#techs" data-toggle="tab" role="tab" aria-controls="techs" aria-selected="true">{{'EXPLORE_TECHS' | translate}}</a>
      </li>
      <li class="nav-item">
        <a   class="nav-link" href="#posts" data-toggle="tab" role="tab" aria-controls="posts" aria-selected="false">{{'EXPLORE_POSTS' | translate}}</a>
      </li>
    </ul>

    <div class="tab-content mt-4">
      <div class="tab-pane active" id="techs">

           <div ng-if="matchingTechs.frameworksAmount == 0 ">{{'EXPLORE_NOT_FOUND' | translate}}</div>

            <div class="row equal">
                <div ng-repeat="tech in matchingTechs.frameworks" class="card mx-4 mb-4">
                  {{tech.name}}
                  <a ng-href="{{tech.location}}">
                    <div class="card-body">
                      <div ng-if="tech.picture != undefined">
                        <div class="max-logo d-flex align-items-center justify-content-center">
                          <img src="{{tech.picture}}" alt="{{'TECH_PICTURE' | translate }}"/>
                        </div>
                      </div>
                      <div ng-if="tech.picture == undefined">
                        <div class="max-logo d-flex align-items-center justify-content-center">
                          <img src="../../images/tech_picture_default.png" alt="{{'TECH_PICTURE' | translate }}"/>
                        </div>
                      </div>
                    </div>
                  <div class="card-footer text-dark">
                    <span>{{tech.name}} | </span><span class="fa fa-star fa-sm"></span><span>{{tech.stars}}</span>
                  </div>
                  </a>
                </div>

            </div>

      </div>
      <!-- POSTS TAB -->
      <div class="tab-pane" id="posts">


            <div ng-if="posts.postsAmount != 0">

                <div ng-repeat="post in posts.posts" class="card mb-3 post-card">
                  <div class="card-body">
                    <div class="row search-post-title ml-1">
                      <a ng-href="/posts/{{post.postId}}">{{post.postTitle}}</a>
                    </div>
                    <div class="row search-post-description ml-1">{{post.postDescription}}</div>
                    <div class="row extra-info">
                      <div class="col-9">
                          <button ng-repeat="tag in post.postTags" class="badge badge-color ml-1" onclick="goToExplore()">
                            <span ng-switch="tag.type.name()">
                              <span ng-switch-when="tech_name">{{tag.tagName}}</span>
                              <span ng-switch-when="tech_type">
                                {{tag.tagName}}
                              </span>
                              <span ng-switch-default>
                                  {{tag.tagName}}
                              </span>
                            </span>
                          </button>

                      </div>
                      <div class="col">
                        <div class="row d-flex secondary-color text-right post-date small-font">
                          {{post.timestamp.toLocaleString()}}
                        </div>
                        <div class="row d-flex secondary-color text-right small-font">
                          <a ng-href="/users/{{post.user.username}}">{{post.user.username}}</a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
            </div>
            <div ng-if="posts.postsAmount == 0">{{'EXPLORE_NOT_FOUND' | translate}}</div>


      </div>
    </div>


  </div>
</div>
